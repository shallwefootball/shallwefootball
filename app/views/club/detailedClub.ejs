<!DOCTYPE html>
<html>
	<head>
		<% include ../layout/head %>
	</head>
	<body>
		<% include ../layout/navbar %>
		<%
			// --- 클럽 --- club.userAuth
			//1. 리더
			//2. 기존 등록이된 플레이어 registered (starting, sub, excepted)는 currentLeague

			//3. 신규선수 (new)
			//4. 이적이완료된 플레이어 (transfered)

			// --- 현재 이적기능을 활성화 하지 않음 ---
			//5. 가입요청온 플레이어 (requestCall)
			//6. 러브콜이 간 플레이어 (loveCall)
			//7. 거부된 플레이어 (rejected)

			// --- 리그 --- league.userJoined
			// 시작전.
				// 리그에 참가됨 (어떤클럽이던)
				// 참가안됨
			// 진행중.
			// 끝
			// 이적시장.

			if (user.transfer.length > 0) {
				user.transfer.forEach(function (item, index) {

					// user의 이적할 클럽들중 보고있는 클럽과 같을경우.
					if (item.clubId == club.clubId) {

						switch (item.transferStatus) {
							// 이적상태	 -- 완료
							case 'transfered' :
								club.userAuth = 'registered';
								break;
							// 이적상태	 -- 대기
							case 'wait' :
								switch (item.transfer) {
									case 'requestCall' :
										club.userAuth = 'requestCall';
										break;
									case 'loveCall' :
										club.userAuth = 'loveCall';
										break;
								}
								break;
							// 거절
							case 'rejected' :
								club.userAuth = 'rejected';
								break;
						}
					}else {
						if(!club.userAuth) {
							club.userAuth = 'new';
						}
						if (club.userAuth != "new") {
							return;
						}
						club.userAuth = 'new';
					}
				});
			// 다를경우는 가입을해야겠지
			// 근데 waitLeague가 있으면 안되겠지?
			// waitLeague는 오지않음 그러니까 new만 하면됨.
			}else {
				if(!club.userAuth) {
					club.userAuth = 'new';
				}
				if (club.userAuth != "new") {
					return;
				}
				club.userAuth = 'new';
			}

			var currentLeague = user.currentLeague[0];

			if (currentLeague) {

				if (currentLeague.clubId == club.clubId) {
					club.userAuth = 'registered';
				}else {
					club.userAuth = 'anotherRegistered';
				}

				if (user.userId == club.leaderId) {
					club.userAuth = 'leader';
				}

			}
			console.log('userAuth   : ', club.userAuth);
		%>
		<div class="container">

			<% console.log("club       :   " , club); %>
			<% console.log("league     :   " , league); %>

			<% include ../layout/joinedUser %>

			<% include ../layout/alertLeague %>

			<div class="panel panel-default">
				<div class="panel-body">

					<% include clubInfo %>


					<%	if (league.status == 'before') { %>
						<% 	//리더
							if (club.userAuth == 'leader') {
						%>

								<% /* include transfering */ %>

								<% include transferedEdit %>

								<% include editPlayer %>
				</div>
			</div>

								<% include ../modal/responseCallModal %>

								<% include ../modal/squadNumberModal %>

								<% include ../modal/positionModal %>

								<% include ../modal/confirmLeagueOutModal %>

								<% include ../modal/addPlayerModal %>

								<% include ../modal/confirmPlayerOutModal %>


						<%	// no leader
							}else {
						%>
							<% include transfered %>

							<% include playerStat %>

							<%
								switch (club.userAuth) {
									case 'new' : %>
										<a type="button" class="btn btn-success btn-lg btn-block" data-toggle="modal" data-target=".requestCallModal">
											이 클럽에 가입요청
										</a>
									<% break;
									case 'registered' : %>

										<button type="button" class="btn btn-lg btn-block positionSquad-btn" data-toggle="modal" data-target=".positionModal"
										data-player-name="<%= club.myInfo[0].playerName %>"
										data-player-id="<%= club.myInfo[0].playerId %>"
										data-player-position="<%= club.myInfo[0].position %>">내 포지션 수정 </button>
										<button type="button" class="btn btn-lg btn-block positionSquad-btn" data-toggle="modal" data-target=".squadNumberModal"
										data-player-name="<%= club.myInfo[0].playerName %>"
										data-player-id="<%= club.myInfo[0].playerId %>"
										data-player-squadNumber="<%= club.myInfo[0].squadNumber %>">내 스쿼드넘버 수정 </button>

										<% include ../modal/squadNumberModal %>
										<% include ../modal/positionModal %>

									<% break;
									case 'requestCall' : %>
										<h1>입단요청하고 대기중이여.</h1>
									<% break;
									case 'loveCall' : %>
										<h1>이팀에서 러브콜 받았어 얼른 수락해.</h1>
									<% break;
								}
							%>
								</div>
							</div>
						<%
							}
						%>

					<%	//not before.
						}else {
					%>
							<div class="row">
								<div class="col-md-12">

									<table class="table">
										<thead>
											<tr>
												<th class="hidden-xs">시즌</th>
												<th>경기</th>
												<th>승</th>
												<th>무</th>
												<th>패</th>
												<th class="hidden-xs">득</th>
												<th class="hidden-xs">실</th>
												<th>차</th>
											</tr>
										</thead>
										<tbody>

											<% club.stats.forEach(function (stat) { %>

												<tr>
													<td class="hidden-xs"><%= stat.season %></td>
													<td><%= stat.played %></td>
													<td><%= stat.won %></td>
													<td><%= stat.drawn %></td>
													<td><%= stat.lost %></td>
													<td class="hidden-xs"><%= stat.for %></td>
													<td class="hidden-xs"><%= stat.against %></td>
													<td><%= stat.different %></td>
												</tr>

											<% }); %>

										</tbody>
									</table>
								</div>
							</div>

							<% include transfered %>

							<% include playerStat %>

						</div></div>
					<%
						}
					%>


			<% /* include ../modal/playerModal */ %>

			<% include ../modal/requestCallModal %>

			<% include ../layout/footer %>

		</div> <!-- /container -->


		<!-- Bootstrap core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<% include ../layout/defaultPlugins %>
		<!-- // <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.0/js/bootstrapValidator.min.js"></script>
		// <script src="/js/libs/bootstrap-select.js"></script>

		// <script src="/js/app/modal-validate.js"></script> -->

		<% /* include ../js/updatePositionSqaudNumberJs */ %>

		<% /* include ../js/removePlayerInClubJs */ %>

		<% /* include ../js/insertPlayerValidatorJs */ %>


	</body>
</html>