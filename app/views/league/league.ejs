<!DOCTYPE html>
<html>
	<head>
		<% include ../layout/head %>
	</head>
	<body>

		<% include ../layout/navbar %>

		<div class="container">

			<h4 class="text-left">League -  </h4>

			<div class="row">
				<div class="col-md-12">
					<div class="panel panel-info">
						<div class="panel-heading">
							<h3 class="panel-title">여주 2015</h3>
						</div>
						<a href="/league/5/match">
							<div class="panel-body">
								<h4>명단 수정기간입니다.</h4>
								<p class="text-center"><strong>2015년 3월 14일 19:00</strong> 까지.</p>
							</div>
						</a>
					</div>
				</div>
			</div>

			<!-- <div class="row"> -->
			<div class="row vertical-align">

		        <div class="col-md-12">
		            <div class="box">
		                <div class="box-icon">
		                	<img id="teamLogo" class="img-circle" src="/images/default/defaultUser140.jpg" width="140" height="140" border="0">
		                </div>
		                <div class="info text-center">
		                    <h4><%= user.playerName %></h4>

							<p>
								<small><i class="fa fa-birthday-cake"></i> <%= user.birthday %></small>
								<br>
								<small><i class="fa fa-envelope-o"></i> <%= user.email %></small>
							</p>
		                </div>

		                <% if (user.currentLeague.length > 0) { %>
						        <div class="col-md-4">
									<center>
										<div class="info-item"><%= user.currentLeague[0].season %></div>
										<a href="/league/<%= user.currentLeague[0].leagueId %>/match">
											<p><%= user.currentLeague[0].community %></p>
										</a>
									</center>
									<p></p>
						        </div>
						        <div class="col-md-4">
						            <center>
						            	<a href="/league/<%= user.currentLeague[0].leagueId %>/club/<%= user.currentLeague[0].clubId %>">
							            	<div class="info-item" style="padding-bottom:8px;">
							            		<img class="vertical-image" src="/images/team/<%= user.currentLeague[0].teamId %>/image.jpg" alt="64x64">
							            	</div>
											<p><%= user.currentLeague[0].teamName %></p>
						            	</a>
									</center>
									<p></p>
						        </div>
						        <div class="col-md-4">
						            <center>
						            	<div class="info-item"><%= user.currentLeague[0].squadNumber %></div>
										<p><%= user.currentLeague[0].position %></p>
									</center>
									<p></p>
						        </div>
						<% }else if (user.transfer.length > 0) { %>

								<% include ../table/playerTransferTable %>
						<% }else if (!(user.joinedLeagues.length > 0 )) { %>
							<center>
								<p>
									현재 소속된 클럽이 없습니다.
									<br>
									<small>클럽에 가입하세요.</small>
								</p>
							</center>
						<% } %>

						<% include ../table/playerCareerTable %>
		            </div>
	        	</div>
			</div>
			<br>
			<br>

			<% include ../layout/footer %>

			<% /* include ../modal/playerModal */ %>

			<div class="modal fade testModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
			</div>

			<script type="text/template" id="item-template">
				<a>{{= playerName }}</a>
				<small class="text-muted"> {{= teamName }} </small>
			</script>

<!--
				<div class="view">
					<input class="toggle" type="checkbox" {{= completed ? 'checked' : '' }}>
					<label>{{- title }}</label>
					<button class="destroy"></button>
				</div>
				<input class="edit" value="{{- title }}"> -->

		</div> <!-- /container -->

		<% include ../layout/defaultPlugins %>

		<script>
			// table sum
			$(".playerCareer tfoot tr:first td:not(:first)").text(function(i){
			    var total = 0;

			    $(".playerCareer tbody").find("td:nth-child("+(i+2)+")").each(function(){

			        total += parseInt( $(this).text(), 10 ) || 0;
			    });
			    return total;
			});

		</script>

		<script>
			var searchApp = {};
			!function ($) {
				searchApp.item = Backbone.Model.extend({
					// idAttribute : 'userId'
				});
				searchApp.ItemList = Backbone.Collection.extend({
					model : searchApp.item,

					url : function (){
						var query = $("#search").val();
						console.log('query         ', query);
						return '/search/' + query;
					}

				});

				searchApp.ItemView = Backbone.View.extend({

					tagName : 'li',

					className : "list-group-item",

					template : _.template($('#item-template').html()),

					initialize : function () {

						// console.log("itemView initialized");
					},
					render : function () {
						var item = this.model.toJSON();
						if(!item.more) {
							// console.log('json    : ', this.model.toJSON());
							this.$el.html(this.template(this.model.toJSON()));
							return this;
						}
					}
				});
				searchApp.AppView = Backbone.View.extend({

					el: $(".navbar-nav"),

					events : {
						'keyup #search': 'getItem',
					},

					initialize : function () {
						this.$list = $('ul#results');

						console.log("initialize is called");

						searchApp.itemList = new searchApp.ItemList();
						this.listenTo(searchApp.itemList, 'reset', this.addAll);

					},

					getItem : function () {
						var query = $("#search").val();
						if (query !== ''){
							searchApp.itemList.fetch({reset : true});
						}else {
							this.clear();
						}
					},

					addOne: function (player) {
						if (!player.attributes.more) {
							var view = new searchApp.ItemView({ model: player });
							this.$list.append(view.render().el);
						}else {
							this.$list.append(
								'<li class="list-group-item">' +
								'<a href="">' + player.attributes.more + '명의 결과 더 보기</a>' +
								'</li>'
							);
						}
					},

					addAll : function () {
						this.clear();
						searchApp.itemList.each(this.addOne, this);
					},

					clear : function () {
						this.$list.html('');
					}

				});

				new searchApp.AppView();

			} ($);
		</script>
	</body>
</html>